<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light"
	data-color-theme="Blue_Theme" data-layout="horizontal"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">
<th:block layout:fragment="content">
	<link th:href="@{/css/jji.css}" rel="stylesheet">
	<div class="col-lg-8 col-md-6 col-12 align-self-center">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb align-items-center">
				<li class="breadcrumb-item"><a
					class="text-muted text-decoration-none" th:href="@{/home}"> <i
						class="ti ti-home fs-5"></i>
				</a></li>
				<li class="breadcrumb-item" aria-current="page">ê²°ì¬ ê´€ë¦¬</li>
			</ol>
		</nav>
		<br>
		<h2 class="mb-0 fw-bolder fs-8">ê²°ì¬ ê´€ë¦¬</h2>
	</div>
	<br>
	<div class="container-fluid my-5 px-4 position-relative">
		<div class="row">
			<!-- ì™¼ìª½ ê²°ì¬ ì–‘ì‹ ì„ íƒ ì˜ì—­ -->
			<div class="col-md-3">
				<div class="card shadow-sm rounded-4 p-4">
					<h5 class="fw-bold mb-4 text-center">ê²°ì¬ ì–‘ì‹</h5>

					<!-- ê²°ì¬ ì–‘ì‹ì´ ìˆì„ ë•Œ -->
					<th:block th:if="${!#lists.isEmpty(formList)}">

						<!-- ì‚¬ìš©ì¤‘ì¸ ê²°ì¬ ì–‘ì‹ -->
						<div class="d-grid gap-2 mb-3">
							<h6 class="text-center text-primary">ì‚¬ìš© ì¤‘</h6>
							<th:block th:each="form : ${formList}"
								th:if="${form.approvalFormStatus} == 'Y'">
								<button class="btn btn-primary form-btn"
									th:value="${form.approvalFormNo}"
									th:text="${form.approvalFormName}"
									th:onclick="|javascript:viewForm('${form.approvalFormNo}')|">ì–‘ì‹</button>
							</th:block>
						</div>

						<!-- ìœ„ì•„ë˜ ë²„íŠ¼ -->
						<div class="text-center my-2">
							<button class="btn btn-sm btn-outline-secondary me-1"
								onclick="changeStatus();">ğŸ”„</button>
						</div>

						<!-- ë³´ê´€ ì¤‘ì¸ ê²°ì¬ ì–‘ì‹ -->
						<div class="d-grid gap-2 mt-3">
							<h6 class="text-center text-secondary">ë³´ê´€ ì¤‘</h6>
							<th:block th:each="form : ${formList}"
								th:if="${form.approvalFormStatus} == 'N'">
								<button class="btn btn-primary form-btn"
									th:value="${form.approvalFormNo}"
									th:text="${form.approvalFormName}"
									th:onclick="|javascript:viewForm('${form.approvalFormNo}')|">ì–‘ì‹</button>
							</th:block>
						</div>
					</th:block>

					<!-- ê²°ì¬ ì–‘ì‹ì´ ì—†ì„ ë•Œ -->
					<th:block th:if="${#lists.isEmpty(formList)}">
						<div class="d-grid gap-3">
							<button class="btn btn-outline-primary" onclick="createForm();">+</button>
						</div>
					</th:block>
				</div>

				<!-- ìƒˆ ì–‘ì‹ ì¶”ê°€ ë²„íŠ¼ -->
				<div class="mt-3 text-center">
					<button class="btn btn-outline-primary" onclick="createForm();">+
						ìƒˆ ì–‘ì‹ ì¶”ê°€</button>
				</div>
			</div>


			<!-- ì˜¤ë¥¸ìª½ ê²°ì¬ ì–‘ì‹ ë‚´ìš© ì˜ì—­ -->
			<div class="col-md-9">
				<div class="card shadow-sm rounded-4 p-4 bg-white"
					style="min-height: 600px; position: relative;">
					<!-- ì—¬ê¸°ì— ë™ì  ì–‘ì‹ ë“¤ì–´ê° -->
					<div id="approval-content">
						<th:block>

						</th:block>
					</div>

					<!-- í•˜ë‹¨ ë²„íŠ¼ -->
					<div
						class="d-flex justify-content-end gap-2 position-absolute bottom-0 end-0 m-4">
						<button class="btn btn-primary px-4" onclick="updateForm();">ìˆ˜ì •</button>
					</div>
				</div>
			</div>
		</div>

	</div>
	<script>
		function createForm() {
		  // fetch() ëŒ€ì‹  í˜ì´ì§€ ì´ë™
		  window.location.href = '/admin/approvalForm/create';
		}
		
		let selectedApprovalFormNo = null; // ì „ì—­ ë³€ìˆ˜
		
		document.addEventListener("DOMContentLoaded", function() {
	        // ì²« ë²ˆì§¸ ë²„íŠ¼ì„ ìë™ í´ë¦­
	        const firstButton = document.querySelector('.form-btn');
	        if (firstButton) {
	          firstButton.click();
	        }
	      });
		
		const viewForm = function(approvalFormNo) {
			  selectedApprovalFormNo = approvalFormNo;

			  fetch('/admin/approvalForm/view/' + selectedApprovalFormNo, {
			    method: 'POST',
			    headers: {
			      'Content-Type': 'application/json',
			      'header': document.querySelector('meta[name="_csrf_header"]').content,
			      'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
			    }
			  })
			  .then(res => res.json())
			  .then(data => {
			    const html = `
			      <h4>${data.approval_form_name}</h4>
			      <div>${data.approval_form}</div>
			    `;
			    document.getElementById('approval-content').innerHTML = html;

			    // ê¸°ì¡´ ì„ íƒëœ ë²„íŠ¼ì—ì„œ í´ë˜ìŠ¤ ì œê±°
			    document.querySelectorAll('.btn-outline-primary, .form-btn').forEach(btn => {
			      btn.classList.remove('active');
			    });

			    // í´ë¦­í•œ ë²„íŠ¼ ì°¾ì•„ì„œ í´ë˜ìŠ¤ ì¶”ê°€
			    const clickedBtn = [...document.querySelectorAll('.btn')].find(
			      btn => btn.getAttribute('onclick') === `javascript:viewForm('${approvalFormNo}')`
			    );

			    if (clickedBtn) {
			      clickedBtn.classList.add('active');
			    }
			  })
			  .catch(err => console.error('Fetch Error:', err));
			};
			
			const changeStatus = function() {
				  console.log('test');
				  
				  let form = document.getElementsByClassName('active')[0];

				  if (form) {
				    let formNo = form.value;
				    console.log(formNo);
				    
				    fetch('/admin/approvalForm/statusUpdate/'+selectedApprovalFormNo,{
				    	method:'POST',
				    	headers: {
						      'Content-Type': 'application/json',
						      'header': document.querySelector('meta[name="_csrf_header"]').content,
						      'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
						}
				    })
				    .then(response => response.json())
			  		.then(data => {
				    	alert(data.res_msg);
				    	if(data.res_code = '200') {
				    		location.reload();
				    	}
			  		});
				    // ì—¬ê¸°ì„œ formNoë¡œ ì‘ì—… ê³„ì† ì§„í–‰
				  } else {
				    console.log('ì„ íƒëœ ì–‘ì‹ì´ ì—†ìŠµë‹ˆë‹¤.');
				    alert('ë¨¼ì € ì–‘ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
				  }
				}
		
		const updateForm = function() {
		  if (selectedApprovalFormNo !== null) {
		    window.location.href = '/admin/approvalForm/update/' + selectedApprovalFormNo;
		  } else {
		    alert('ë¨¼ì € ìˆ˜ì •í•  ì–‘ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
		  }
		};
	</script>
	
	<!-- ---------------------------------------------------------------------------- -->
	
	<!-- Custom JS Files -->
	
	
	
	<!-- Bootstrap Common JS Files Start -->

	<!-- Import vendorJs Files -->
	<script th:src="@{/assets/js/vendor.min.js}"></script>
	
  	<!-- Import Js Files -->
  	<script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  	<script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
  	<script th:src="@{/assets/js/theme/app.init.js}"></script>
  	<script th:src="@{/assets/js/theme/theme.js}"></script>
  	<script th:src="@{/assets/js/theme/app.min.js}"></script>
  	<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>

  	<!-- solar icons -->
  	<script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  	<script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
  	<script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  	<script th:src="@{/assets/js/dashboards/dashboard.js}"></script>
  	
  	<!-- Bootstrap Common JS Files End -->
  	
  	<!-- Custom JS Files -->
  	

</th:block>
</html>