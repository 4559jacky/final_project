<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light"
	data-color-theme="Blue_Theme" data-layout="horizontal"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">

<!-- HEAD 생략: layout에서 상속받음 -->

<th:block layout:fragment="content">
	<div class="col-lg-8 col-md-6 col-12 align-self-center">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb align-items-center">
				<li class="breadcrumb-item"><a
					class="text-muted text-decoration-none" th:href="@{/home}"> <i
						class="ti ti-home fs-5"></i>
				</a></li>
				<li class="breadcrumb-item" aria-current="page">결재 관리</li>
			</ol>
		</nav>
		<br>
		<h2 class="mb-0 fw-bolder fs-8">결재 양식 생성</h2>
	</div>
	<br>

	<!-- 📌 Bootstrap 스타일 적용된 Form -->
	<form name="create_approval_form" action="/admin/approvalForm/create"
		method="post">
		<div class="container mt-4">
			<div class="card shadow-sm p-4">
				<!-- 제목 + 버튼 -->
				<div class="row align-items-center mb-3">
					<div class="col-md-9 col-sm-12 mb-2 mb-md-0">
						<label for="approval_form_name" class="form-label fw-semibold">제목</label>
						<input type="text" class="form-control" id="approval_form_name"
							name="approval_form_name" placeholder="양식 제목을 입력하세요"> <input
							type="hidden" name="approval_form_status" value="Y">
					</div>
					<div class="col-md-3 col-sm-12 text-md-end text-start">
						<label class="d-none d-md-block invisible">제출</label>
						<!-- 높이 맞춤용 -->
						<input type="submit" class="btn btn-primary w-100" value="양식 생성">
					</div>
				</div>

				<!-- 에디터 영역 -->
				<div class="post-form">
                    <div id="editor" style="margin-top: 10px;"></div>
                    <textarea id="approval_form_content" name="approval_form" hidden></textarea>
                </div>
			</div>
		</div>
	</form>
</th:block>

<!-- 스크립트는 여기에 넣기 -->
<th:block layout:fragment="scripts">
	<link href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" rel="stylesheet" />
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    
	<script>
	
	document.addEventListener("DOMContentLoaded", function () {
        const editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '400px',
            initialEditType: 'wysiwyg',
            previewStyle: 'vertical'
        });
        
        
        const form = document.create_approval_form;
        form.addEventListener('submit', (e) => {
        	  e.preventDefault();

        	  let vali_check = false;
        	  let vali_text = "";

        	  const title = form.approval_form_name.value;
        	  const content = editor.getHTML();
        	  form.approval_form.value = content;
        	  if (!title) {
        	    vali_text += "제목을 입력하세요.";
        	  } else if (!content || content === '<p><br></p>') {
        	    vali_text += "내용을 입력하세요.";
        	  } else {
        	    vali_check = true;
        	  }

        	  if (!vali_check) {
        	    alert(vali_text);
        	  } else {

        	    const payload = new FormData(form);

        	    fetch("/admin/approvalForm/create", {
        	      	method: 'post',
        	      	headers : {
    					'header': document.querySelector('meta[name="_csrf_header"]').content,
    	              	'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
    				},
        	      	body: payload
        	    })
        	    .then(response => response.json())
        	    .then(data => {
        	      console.log(data);
        	      alert(data.res_msg);
        	      if (data.res_code === '200') {
        	        location.href = '/admin/approval';
        	      }
        	    })
        	    .catch(error => {
        	      console.log(error);
        	    });
        	  }
        	});
	});
  </script>
  <!-- Import vendorJs Files -->
	<script th:src="@{/assets/js/vendor.min.js}"></script>
	
  	<!-- Import Js Files -->
  	<script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  	<script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
  	<script th:src="@{/assets/js/theme/app.init.js}"></script>
  	<script th:src="@{/assets/js/theme/theme.js}"></script>
  	<script th:src="@{/assets/js/theme/app.min.js}"></script>
  	<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>

  	<!-- solar icons -->
  	<script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  	<script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
  	<script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  	<script th:src="@{/assets/js/dashboards/dashboard.js}"></script>
  	
  	<!-- Bootstrap Common JS Files End -->
</th:block>
</html>
