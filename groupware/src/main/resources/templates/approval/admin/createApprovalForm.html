<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light" data-color-theme="Blue_Theme" data-layout="horizontal"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{/include/layout}">

<!-- HEAD ìƒëµ: layoutì—ì„œ ìƒì†ë°›ìŒ -->

<th:block layout:fragment="content">
	<div class="col-lg-8 col-md-6 col-12 align-self-center">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb align-items-center">
          <li class="breadcrumb-item">
            <a class="text-muted text-decoration-none" th:href="@{/home}">
              <i class="ti ti-home fs-5"></i>
            </a>
          </li>
          <li class="breadcrumb-item" aria-current="page">ê²°ì¬ ê´€ë¦¬</li>
        </ol>
      </nav><br>
      <h2 class="mb-0 fw-bolder fs-8">ê²°ì¬ ì–‘ì‹ ìƒì„±</h2>
    </div><br>
	<!-- ğŸ“Œ Summernote CSSëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">

<!-- ğŸ“Œ Bootstrap ìŠ¤íƒ€ì¼ ì ìš©ëœ Form -->
<form name="create_approval_form" action="/admin/approvalForm/create" method="post">
  <div class="container mt-4">
    <div class="card shadow-sm p-4">
      <!-- ì œëª© + ë²„íŠ¼ -->
      <div class="row align-items-center mb-3">
        <div class="col-md-9 col-sm-12 mb-2 mb-md-0">
          <label for="approval_form_name" class="form-label fw-semibold">ì œëª©</label>
          <input type="text" class="form-control" id="approval_form_name" name="approval_form_name" placeholder="ì–‘ì‹ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
          <input type="hidden" name="approval_form_status" value="Y">
        </div>
        <div class="col-md-3 col-sm-12 text-md-end text-start">
          <label class="d-none d-md-block invisible">ì œì¶œ</label> <!-- ë†’ì´ ë§ì¶¤ìš© -->
          <input type="submit" class="btn btn-primary w-100" value="ì–‘ì‹ ìƒì„±">
        </div>
      </div>

      <!-- ì—ë””í„° ì˜ì—­ -->
      <div class="post-form">
        <textarea name="approval_form" id="summernote"></textarea>
      </div>
    </div>
  </div>
</form>
</th:block>

<!-- ìŠ¤í¬ë¦½íŠ¸ëŠ” ì—¬ê¸°ì— ë„£ê¸° -->
<th:block layout:fragment="scripts">
  <script>
    $(document).ready(function () {
      console.log("Summernote ìƒíƒœ:", $.fn.summernote);

      $('#summernote').summernote({
    	    height: 800,
    	    lang: 'ko-KR',
    	    codeviewFilter: false,
    	    toolbar: [
    	      ['fontsize', ['fontsize']],
    	      ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
    	      ['color', ['color']],
    	      ['table', ['table']],
    	      ['para', ['ul', 'ol', 'paragraph']],
    	      ['height', ['height']],
    	      ['insert',['picture']]
    	    ],
    	    fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','ë§‘ì€ ê³ ë”•','ê¶ì„œ','êµ´ë¦¼ì²´','êµ´ë¦¼','ë‹ìŒì²´','ë°”íƒ•ì²´'],
    	    fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72','96'],
    	    focus: true,
    	    callbacks: {
    	      onInit: function () {
    	        // ëª¨ë“  ë“œë¡­ë‹¤ìš´ í•­ëª© ì„ íƒ ì‹œ ë‹«í˜ ì²˜ë¦¬
    	        $(document).on('click', '.dropdown-menu a, .note-dimension-picker', function () {
    	          setTimeout(function () {
    	            $('.dropdown-menu').removeClass('show');
    	          }, 150); // ìì—°ìŠ¤ëŸ½ê²Œ ë‹«íˆë„ë¡ ë”œë ˆì´
    	        });
    	      }
    	    }
    	  });

      // ğŸ‘‡ Bootstrap 5ì—ì„œ dropdown toggleì„ ê°•ì œë¡œ ìˆ˜ë™ ì—°ê²°
      $('body').on('click', '.note-btn.dropdown-toggle', function (e) {
        var $dropdown = $(this).next('.dropdown-menu');
        $('.dropdown-menu').not($dropdown).removeClass('show'); // ë‹¤ë¥¸ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        $dropdown.toggleClass('show');
      });

      // ğŸ‘‡ ë‹¤ë¥¸ ê³³ í´ë¦­í•˜ë©´ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
      $(document).on('click', function (e) {
        if (!$(e.target).closest('.note-editor').length) {
          $('.dropdown-menu').removeClass('show');
        }
      });
    });
    
    const form = document.create_approval_form;
    form.addEventListener('submit', (e) => {
    	  e.preventDefault();

    	  let vali_check = false;
    	  let vali_text = "";

    	  const title = form.approval_form_name.value;
    	  const content = $('#summernote').summernote('code');

    	  if (!title) {
    	    vali_text += "ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.";
    	  } else if (!content || content === '<p><br></p>') {
    	    vali_text += "ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.";
    	  } else {
    	    vali_check = true;
    	  }

    	  if (!vali_check) {
    	    alert(vali_text);
    	  } else {
    	    // ğŸ‘‰ summernote ê°’ ìˆ˜ë™ ì£¼ì…!
    	    $('#summernote').val(content);

    	    const payload = new FormData(form);

    	    fetch("/admin/approvalForm/create", {
    	      	method: 'post',
    	      	headers : {
					'header': document.querySelector('meta[name="_csrf_header"]').content,
	              	'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
				},
    	      	body: payload
    	    })
    	    .then(response => response.json())
    	    .then(data => {
    	      console.log(data);
    	      alert(data.res_msg);
    	      if (data.res_code === '200') {
    	        location.href = '/admin/approval';
    	      }
    	    })
    	    .catch(error => {
    	      console.log(error);
    	    });
    	  }
    	});
    
  </script>
</th:block>
</html>
