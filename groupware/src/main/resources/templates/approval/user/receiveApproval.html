<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light"
	data-color-theme="Blue_Theme" data-layout="horizontal"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">

<th:block layout:fragment="content">
	<div class="container-fluid px-4">
		<!-- Breadcrumb -->
		<div class="col-lg-8 col-md-6 col-12 align-self-center">
			<nav aria-label="breadcrumb">
				<ol class="breadcrumb align-items-center">
					<li class="breadcrumb-item"><a
						class="text-muted text-decoration-none" th:href="@{/home}"> <i
							class="ti ti-home fs-5"></i>
					</a></li>
					<li class="breadcrumb-item" aria-current="page">전자 결재 시스템</li>
					<li class="breadcrumb-item active" aria-current="page">받은 문서함</li>
				</ol>
			</nav>
			<br>
			<h2 class="mb-0 fw-bolder fs-8">전자 결재 시스템</h2>
		</div>
		<br>

		<!-- Tabs -->
		<ul class="nav nav-tabs mb-4">
			<li class="nav-item"><a class="nav-link" th:href="@{/approval}">보낸
					문서함</a></li>
			<li class="nav-item"><a class="nav-link active"
				th:href="@{/approval/receive}">받은 문서함</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="@{/approval/create}">결재 작성</a></li>
		</ul>

		<!-- Summary Cards -->
		<div class="container-fluid my-5 px-4">
			<!-- 전체 너비 확장 -->
			<div class="row g-3 text-center">
				<div class="col-md">
					<!-- 자동 비율로 5등분 -->
					<div class="card shadow-sm rounded-4 p-3 h-100">
						<div class="fs-3">⏳</div>
						<div class="fw-semibold">대기중인 결재</div>
						<div class="fs-4 fw-bold mt-1 text-primary"
							th:text="${pendingCount}">4</div>
					</div>
				</div>
				<div class="col-md">
					<div class="card shadow-sm rounded-4 p-3 h-100">
						<div class="fs-3">✅</div>
						<div class="fw-semibold">승인한 결재</div>
						<div class="fs-4 fw-bold mt-1 text-success"
							th:text="${approvedCount}">56</div>
					</div>
				</div>
				<div class="col-md">
					<div class="card shadow-sm rounded-4 p-3 h-100">
						<div class="fs-3">❌</div>
						<div class="fw-semibold">반려된 결재</div>
						<div class="fs-4 fw-bold mt-1 text-danger"
							th:text="${rejectedCount}">31</div>
					</div>
				</div>
				<div class="col-md">
					<div class="card shadow-sm rounded-4 p-3 h-100">
						<div class="fs-3">👀</div>
						<div class="fw-semibold">참조된 결재</div>
						<div class="fs-4 fw-bold mt-1 text-secondary"
							th:text="${referencedCount}">242</div>
					</div>
				</div>
				<div class="col-md">
					<div class="card shadow-sm rounded-4 p-3 h-100">
						<div class="fs-3">🤝</div>
						<div class="fw-semibold">합의된 결재</div>
						<div class="fs-4 fw-bold mt-1 text-info" th:text="${agreedCount}">11</div>
					</div>
				</div>
			</div>
		</div>


		<!-- Search -->
		<div class="d-flex justify-content-between align-items-center mb-3">
			<form class="position-relative" action="/approval/search" method="get">
                    <input type="text" class="form-control search-chat py-2 ps-5" id="text-srh" placeholder="Search Product">
                    <i class="ti ti-search position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
            </form>
			<button class="btn btn-primary" onclick="createApproval();">결재 작성</button>
		</div>

		<!-- Table -->
		<div class="table-wrapper p-4 bg-white rounded-4 shadow-sm">
			<div class="table-responsive">
				<table class="table align-middle text-center">
					<!-- 테이블 헤더 -->
					<thead class="table-light">
						<tr>
							<th>번호</th>
							<th>제목</th>
							<th>작성자</th>
							<th>상태</th>
							<th>관련</th>
							<th>작성일</th>
							<th>양식 종류</th>
						</tr>
					</thead>
					<!-- 테이블 바디 -->
					<tbody>
						<tr th:if="${#lists.isEmpty(approvalVoList)}">
							<td colspan="7">받은 결재 요청이 없습니다.</td>
						</tr>
						<tr th:if="${!#lists.isEmpty(approvalVoList)}"
							th:each="approvalVo, approvalStatus : ${approvalVoList}"
							th:attr="data-approver-no=${approvalVo.appr_no}">
							<td th:text="${approvalVoList.size() - approvalStatus.index}">번호</td>
							<td><a th:href="@{/approval/receive/detail/{id}(id=${approvalVo.appr_no})}" th:text="${approvalVo.appr_title}">제목</a></td>
							<td th:text="${approvalVo.member_name}">작성자</td>
							<th:block th:if="${approvalVo.appr_status == 'A'}">
								<td><span class="badge bg-warning-subtle text-dark">합의 대기중</span></td>
							</th:block>
							<th:block th:if="${approvalVo.appr_status == 'D'}">
								<td><span class="badge bg-warning-subtle text-dark">결재 대기중</span></td>
							</th:block>
							<th:block th:if="${approvalVo.appr_status == 'C'}">
								<td><span class="badge bg-warning-subtle text-dark">승인</span></td>
							</th:block>
							<th:block th:if="${approvalVo.appr_status == 'R'}">
								<td><span class="badge bg-warning-subtle text-dark">반려</span></td>
							</th:block>
							<!-- 결재 관련자 종류 구분 -->
							<th:block th:if="${approvalVo.relationship == 'P'}">
								<td><span class="badge bg-warning-subtle text-dark">결재자</span></td>
							</th:block>
							<th:block th:if="${approvalVo.relationship == 'A'}">
								<td><span class="badge bg-warning-subtle text-dark">합의자</span></td>
							</th:block>
							<th:block th:if="${approvalVo.relationship == 'R'}">
								<td><span class="badge bg-warning-subtle text-dark">참조자</span></td>
							</th:block>
							<td th:text="${#temporals.format(approvalVo.appr_req_date,'yyyy-MM-dd HH:mm')}">요청일</td>
							<td th:text="${approvalVo.approval_form_name}">양식
								종류</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Pagination -->
		<nav class="d-flex justify-content-center mt-4">
			<ul class="pagination">
				<li class="page-item disabled"><a class="page-link">‹</a></li>
				<li class="page-item active"><a class="page-link" href="#">1</a></li>
				<li class="page-item"><a class="page-link" href="#">2</a></li>
				<li class="page-item"><a class="page-link" href="#">3</a></li>
				<li class="page-item"><a class="page-link" href="#">...</a></li>
				<li class="page-item"><a class="page-link" href="#">10</a></li>
				<li class="page-item"><a class="page-link" href="#">›</a></li>
			</ul>
		</nav>
	</div>
	
	
	<script>
		const createApproval = function() {
			location.href = '/approval/create';
		}
	</script>
	
	
	
	<!-- Import vendorJs Files -->
	<script th:src="@{/assets/js/vendor.min.js}"></script>
	
  	<!-- Import Js Files -->
  	<script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  	<script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
  	<script th:src="@{/assets/js/theme/app.init.js}"></script>
  	<script th:src="@{/assets/js/theme/theme.js}"></script>
  	<script th:src="@{/assets/js/theme/app.min.js}"></script>
  	<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>

  	<!-- solar icons -->
  	<script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  	<script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
  	<script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  	<script th:src="@{/assets/js/dashboards/dashboard.js}"></script>
  	
  	<!-- Bootstrap Common JS Files End -->
</th:block>
</html>
