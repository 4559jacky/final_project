<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light" data-color-theme="Blue_Theme" data-layout="horizontal"
xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{/include/layout}">

<th:block layout:fragment="content">
  <div class="container-fluid px-4">
    <!-- Breadcrumb -->
    <div class="col-lg-8 col-md-6 col-12 align-self-center">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb align-items-center">
          <li class="breadcrumb-item">
            <a class="text-muted text-decoration-none" th:href="@{/home}">
              <i class="ti ti-home fs-5"></i>
            </a>
          </li>
          <li class="breadcrumb-item" aria-current="page">전자 결재 시스템</li>
          <li class="breadcrumb-item active" aria-current="page">받은 문서함</li>
        </ol>
      </nav><br>
      <h2 class="mb-0 fw-bolder fs-8">전자 결재 시스템</h2>
    </div><br>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item">
        <a class="nav-link" th:href="@{/approval}">보낸 문서함</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:href="@{/approval/receive}">받은 문서함</a>
      </li>
      <li class="nav-item">
        <a class="nav-link active" th:href="@{/approval/create}">결재 작성</a>
      </li>
    </ul>
    <div class="container-fluid my-5 px-4">
	  <div class="row">
		  <!-- 왼쪽 결재 양식 선택 영역 -->
		  <div class="col-md-3">
		    <div class="card shadow-sm rounded-4 p-4">
		      <h5 class="fw-bold mb-4 text-center">결재 양식</h5>
		      <div class="d-grid gap-3">
		        <th:block th:if=${!#lists.isEmpty(formList)}
		        		th:each="form : ${formList}">
		        	<th:block th:if="${form.approvalFormStatus == 'Y'}">
		        		<!-- class="btn btn-primary" -->
			        	<button class="btn btn-outline-primary" th:text="${form.approvalFormName}"
			        	th:onclick="|javascript:viewForm('${form.approvalFormNo}')|">양식 이름</button>
		        	</th:block>
		        </th:block>
		      </div>
		    </div>
		  </div>
		
		  <!-- 오른쪽 결재 양식 내용 영역 -->
			<div class="col-md-9">
			  <div class="card shadow-sm rounded-4 p-4 bg-white" style="min-height: 600px; position: relative;">
			    <!-- 여기에 동적 양식 들어감 -->
			    <div id="approval-content">
					<th:block>
						
					</th:block>
			    </div>
			
			    <!-- 하단 버튼 -->
			    <div class="d-flex justify-content-end gap-2 position-absolute bottom-0 end-0 m-4">
			      <button class="btn btn-primary px-4" onclick="createApproval();">결재 작성</button>
			    </div>
			  </div>
			</div>
		</div>
	</div>
	</div>
	<script>
	  let selectedApprovalFormNo = null; // 전역 변수

	  const viewForm = function(approvalFormNo) {
	    selectedApprovalFormNo = approvalFormNo; // 선택한 양식 번호 저장

	    fetch('/admin/approvalForm/view/' + approvalFormNo, {
	      method: 'POST',
	      headers: {
	        'Content-Type': 'application/json',
	        'header': document.querySelector('meta[name="_csrf_header"]').content,
	        'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
	      }
	    })
	    .then(res => res.json())
	    .then(data => {
	      const html = `
	        <h4>${data.approval_form_name}</h4>
	        <div>${data.approval_form}</div>
	      `;
	      document.getElementById('approval-content').innerHTML = html;

	      // 버튼 강조
	      document.querySelectorAll('.btn-outline-primary, .btn-primary').forEach(btn => {
	        btn.classList.remove('btn-primary');
	        btn.classList.add('btn-outline-primary');
	      });

	      const clickedBtn = [...document.querySelectorAll('.btn')].find(
	        btn => btn.getAttribute('onclick') === `viewForm(${approvalFormNo})` ||
	               btn.getAttribute('onclick') === `viewForm('${approvalFormNo}')`
	      );

	      if (clickedBtn) {
	        clickedBtn.classList.remove('btn-outline-primary');
	        clickedBtn.classList.add('btn-primary');
	      }
	    })
	    .catch(err => console.error('Fetch Error:', err));
	  };
	</script>

</th:block>
</html>
