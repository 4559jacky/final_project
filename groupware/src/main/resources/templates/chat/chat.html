<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">
<th:block layout:fragment="content">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
	<link th:href="@{/css/ysw.css}" rel="stylesheet">

	<!-- 상단 메뉴 표시  -->
	<div class="col-lg-8 col-md-6 col-12 align-self-center">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb align-items-center">
				<li class="breadcrumb-item"><a
					class="text-muted text-decoration-none" th:href="@{/home}"> <i
						class="ti ti-home fs-5"></i>
				</a></li>
				<li class="breadcrumb-item" aria-current="page">사내 채팅</li>
			</ol>
		</nav>
		<br>
		<h2 class="mb-0 fw-bolder fs-8">사내 채팅</h2>
	</div>
	<br>

	<div class="card overflow-hidden chat-application">
		<div
			class="d-flex align-items-center justify-content-between gap-6 m-3 d-lg-none">
			<button class="btn btn-primary d-flex" type="button"
				data-bs-toggle="offcanvas" data-bs-target="#chat-sidebar"
				aria-controls="chat-sidebar">
				<i class="ti ti-menu-2 fs-5"></i>
			</button>
		</div>
		<div class="d-flex">
			<div class="w-30 d-none d-lg-block border-end user-chat-box">
				<div class="px-4 pt-9 pb-6">
					<!-- 현재 로그인한 사원 정보  -->
					<div class="d-flex align-items-center justify-content-between mb-3">
						<div class="d-flex align-items-center">
							<div class="position-relative">
								<img src="../assets/images/profile/user-1.jpg" alt="user1"
									width="54" height="54" class="rounded-circle" />
							</div>
							<div class="ms-3">
								<h6 th:text="|${#authentication.principal.member.memberName} ${#authentication.principal.member.pos.posName}|" class="fw-semibold mb-2"></h6>
								<p th:text="${#authentication.principal.member.dept.deptName}" class="mb-0 fs-2">부서</p>
							</div>
						</div>

					</div>
					<!-- 채팅 목록 검색 -->
					<form class="position-relative mb-4">
						<input type="text" class="form-control search-chat py-2 ps-5"
							id="text-srh" placeholder="채팅방 이름을 검색하세요." /> <i
							class="ti ti-search position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
					</form>
				</div>
				<!-- 채팅방 목록 -->
				<div class="app-chat" >
					<ul th:if="${!#lists.isEmpty(chatRoomList)}" 
						th:each="chatRoom : ${chatRoomList}"
						th:attr="data-room-no=${chatRoom.chatRoomNo}"
						class="chat-users mb-0 mh-n100" data-simplebar>
						<li><a href="javascript:void(0)"
							class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
							id="chat_user_3" data-user-id="3">
								<div class="d-flex align-items-center">
									<span class="position-relative"> <img
										src="../assets/images/profile/user-8.jpg" alt="user-8"
										width="48" height="48" class="rounded-circle" /> <span
										class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-warning">
											<span class="visually-hidden">New alerts</span>
									</span>
									</span>
									<div class="ms-3 d-inline-block w-75">
										<h6 th:text="${chatRoom.chatRoomTitle}" class="mb-1 fw-semibold chat-title">채팅방 이름</h6>
										<span th:text="${chatRoom.lastMsg}" class="fs-3 text-truncate text-body-color d-block">마지막 메세지</span>
									</div>
								</div>
								<p th:text="${#temporals.format(chatRoom.lastMsgDate, 'yy-MM-dd mm:ss')}" class="fs-2 mb-0 text-muted">보낸 시간</p>
						</a></li>
					</ul>
					<ul th:if="${#lists.isEmpty(chatRoomList)}" class="chat-users mb-0 mh-n100" data-simplebar>
						<li>
							<div class="ms-3 d-inline-block w-75 text-center">
								<h6 class="mb-1 fw-semibold chat-title">채팅 중인 방이 없습니다.</h6>
								
							</div>
						</li>
					</ul>
				</div>
				 <div class="px-9 py-6 border-top text-center">
				    <button class="btn btn-primary px-4" type="button">
				      + 새로운 채팅 추가 
				    </button>
				  </div>
			</div>
			<div class="w-70 w-xs-100 chat-container">
				<div class="chat-box-inner-part h-100">
					<div class="chat-not-selected h-100 d-none">
						<div
							class="d-flex align-items-center justify-content-center h-100 p-5">
							<div class="text-center">
								<span class="text-primary"> <i
									class="ti ti-message-dots fs-10"></i>
								</span>
								<h6 class="mt-2">Open chat from the list</h6>
							</div>
						</div>
					</div>
					<!-- 채팅 박스  -->
					<div class="chatting-box d-block">
						<div
							class="p-9 border-bottom chat-meta-user d-flex align-items-center justify-content-between">
							<div class="hstack gap-3 current-chat-user-name">
								<div class="position-relative">
									<img src="../assets/images/profile/user-3.jpg" alt="user1"
										width="48" height="48" class="rounded-circle" />

								</div>
								<div>
									<h6 class="mb-1 name fw-semibold"></h6>
									<p class="mb-0">Away</p>
								</div>
							</div>
							<ul class="list-unstyled mb-0 d-flex align-items-center">
								<li><a
									class="chat-menu text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
									href="javascript:void(0)"> <i class="ti ti-menu-2"></i>
								</a></li>
							</ul>
						</div>
						<div class="d-flex parent-chat-box">
							<div class="chat-box w-xs-100">
								<div class="chat-box-inner p-9" data-simplebar>
									<div class="chat-list chat active-chat" data-user-id="1">
										<div
											class="hstack gap-3 align-items-start mb-7 justify-content-start">
											<img src="../assets/images/profile/user-8.jpg" alt="user8"
												width="40" height="40" class="rounded-circle" />
											<div>
												<h6 class="fs-2 text-muted">Andrew, 2 hours ago</h6>
												<div
													class="p-2 text-bg-light rounded-1 d-inline-block text-dark fs-3">
													I want more detailed information.</div>
											</div>
										</div>
										<div
											class="hstack gap-3 align-items-start mb-7 justify-content-end">
											<div class="text-end">
												<h6 class="fs-2 text-muted">2 hours ago</h6>
												<div
													class="p-2 bg-info-subtle text-dark mb-1 d-inline-block rounded-1 fs-3">
													If I don’t like something, I’ll stay away from it.</div>
												<div class="p-2 bg-info-subtle text-dark rounded-1 fs-3">
													They got there early, and they got really good seats.</div>
											</div>
										</div>
									</div>
									
									<div class="chat-list chat" data-user-id="3">
										<div
											class="hstack gap-3 align-items-start mb-7 justify-content-start">
											<img src="../assets/images/profile/user-8.jpg" alt="user8"
												width="40" height="40" class="rounded-circle" />
											<div>
												<h6 class="fs-2 text-muted">Andrew, 2 hours ago</h6>
												<div
													class="p-2 text-bg-light rounded-1 d-inline-block text-dark fs-3">
													I want more detailed information.</div>
											</div>
										</div>
										<div
											class="hstack gap-3 align-items-start mb-7 justify-content-end">
											<div class="text-end">
												<h6 class="fs-2 text-muted">2 hours ago</h6>
												<div
													class="p-2 bg-info-subtle text-dark mb-1 d-inline-block rounded-1 fs-3">
													If I don’t like something, I’ll stay away from it.</div>
												<div class="p-2 bg-info-subtle text-dark rounded-1 fs-3">
													They got there early, and they got really good seats.</div>
											</div>
										</div>
										
									</div>
								</div>
								<div class="px-9 py-6 border-top chat-send-message-footer">
									<div class="d-flex align-items-center justify-content-between">
										<div class="d-flex align-items-center gap-2 w-85">
											<input type="text"
												class="form-control message-type-box text-muted border-0 p-0 ms-2"
												placeholder="Type a Message" fdprocessedid="0p3op" />
										</div>
										<ul class="list-unstyledn mb-0 d-flex align-items-center">
											<li><a
												class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
												href="javascript:void(0)"> <i class="ti ti-photo-plus"></i>
											</a></li>
											<li><a
												class="text-dark px-2 fs-7 bg-hover-primary nav-icon-hover position-relative z-index-5"
												href="javascript:void(0)"> <i class="ti ti-paperclip"></i>
											</a></li>
										</ul>
									</div>
								</div>
							</div>
							<div class="app-chat-offcanvas border-start">
								<div class="custom-app-scroll mh-n100" data-simplebar>
									<div
										class="p-3 d-flex align-items-center justify-content-between">
										<h6 class="fw-semibold mb-0 text-nowrap">
											Media <span class="text-muted">(36)</span>
										</h6>
										<a
											class="chat-menu d-lg-none d-block text-dark fs-6 bg-hover-primary nav-icon-hover position-relative z-index-5"
											href="javascript:void(0)"> <i class="ti ti-x"></i>
										</a>
									</div>
									<div class="offcanvas-body p-9">

										<div class="row mb-7 text-nowrap">
											<div class="col-4 px-1 mb-2">

												<img src="../assets/images/products/product-1.jpg"
													width="88" height="65" alt="flexy-img" class="rounded" />

											</div>
										</div>
										<div class="files-chat">
											<h6 class="fw-semibold mb-3 text-nowrap">
												Files <span class="text-muted">(36)</span>
											</h6>
											<a href="javascript:void(0)"
												class="hstack gap-3 file-chat-hover justify-content-between text-nowrap mb-9">
												<div class="d-flex align-items-center gap-3">
													<div class="rounded-1 text-bg-light p-6">
														<img src="../assets/images/chat/icon-zip-folder.svg"
															alt="flexy-img" width="24" height="24" />
													</div>
													<div>
														<h6 class="fw-semibold">work-project.zip</h6>
														<div
															class="d-flex align-items-center gap-3 fs-2 text-muted">
															<span>2 MB</span> <span>2 Dec 2024</span>
														</div>
													</div>
												</div> <span
												class="position-relative nav-icon-hover download-file">
													<i class="ti ti-download text-dark fs-6 bg-hover-primary"></i>
											</span>
											</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="offcanvas offcanvas-start user-chat-box chat-offcanvas"
				tabindex="-1" id="chat-sidebar"
				aria-labelledby="offcanvasExampleLabel">
				<div class="offcanvas-header">
					<h5 class="offcanvas-title" id="offcanvasExampleLabel">채팅목록</h5>
					<button type="button" class="btn-close" data-bs-dismiss="offcanvas"
						aria-label="Close"></button>
				</div>
				<div class="px-4 pt-9 pb-6">
					<div class="d-flex align-items-center justify-content-between mb-3">
						<div class="d-flex align-items-center">
							<div class="position-relative">
								<img src="../assets/images/profile/user-1.jpg" alt="user1"
									width="54" height="54" class="rounded-circle" />
							</div>
							<div class="ms-3">
								<h6 th:text="|${#authentication.principal.member.memberName} ${#authentication.principal.member.pos.posName}|" class="fw-semibold mb-2"></h6>
								<p th:text="${#authentication.principal.member.dept.deptName}" class="mb-0 fs-2">부서</p>
							</div>
						</div>

					</div>
					<form class="position-relative mb-4">
						<input type="text" class="form-control search-chat py-2 ps-5"
							id="text-srh" placeholder="채팅방 이름을 검색하세요." /> <i
							class="ti ti-search position-absolute top-50 start-0 translate-middle-y fs-6 text-dark ms-3"></i>
					</form>
				</div>
				<div class="app-chat">
					<ul th:if="${!#lists.isEmpty(chatRoomList)}" 
						th:each="chatRoom : ${chatRoomList}"
						th:attr="data-room-no=${chatRoom.chatRoomNo}"
						class="class="chat-users p-0 m-0" style="padding-top: 0; padding-bottom: 0;"" data-simplebar>
						<li><a href="javascript:void(0)"
							class="px-4 py-3 bg-hover-light-black d-flex align-items-start justify-content-between chat-user"
							id="chat_user_3" data-user-id="3">
								<div class="d-flex align-items-center">
									<span class="position-relative"> <img
										src="../assets/images/profile/user-8.jpg" alt="user-8"
										width="48" height="48" class="rounded-circle" /> <span
										class="position-absolute bottom-0 end-0 p-1 badge rounded-pill bg-warning">
											<span class="visually-hidden">New alerts</span>
									</span>
									</span>
									<div class="ms-3 d-inline-block w-75">
										<h6 th:text="${chatRoom.chatRoomTitle}" class="mb-1 fw-semibold chat-title">채팅방 이름</h6>
										<span th:text="${chatRoom.lastMsg}" class="fs-3 text-truncate text-body-color d-block">마지막 메세지</span>
									</div>
								</div>
								<p th:text="${#temporals.format(chatRoom.lastMsgDate, 'yy-MM-dd mm:ss')}" class="fs-2 mb-0 text-muted">보낸 시간</p>
						</a></li>
					</ul>
					<ul th:if="${#lists.isEmpty(chatRoomList)}" class="chat-users mb-0 mh-n100" data-simplebar>
						<li>
							<div class="ms-3 d-inline-block w-75 text-center">
								<h6 class="mb-1 fw-semibold chat-title">채팅 중인 방이 없습니다.</h6>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	
	
	
	
	
	
	<h1>WebSocket 테스트</h1>
	<input type="text" id="msg">
	<input type="button" value="전송" onclick="sendMsg();">
	<div id="output"></div>
	<script>
		let socket = new WebSocket("ws://localhost:8080/ws/basic");
		socket.onopen = function(){
			// 클라이언트 -> 서버 연결합시다!! 
			// 서버의 afterConnectionEstablished 메소드
			console.log("클라이언트 : 연결");
		}
		socket.onmessage = function(event){
			// 클라이언트 -> 서버 메시지 send
			// 메시지를 서버가 handleTextMessage에서 처리
			// 서버의 sendMessage 메소드 동작
			// console.log(event.data);
			document.getElementById('output').innerHTML += '<p>'+event.data+"</p>";
		}
		const sendMsg = function(){
			let msg = document.getElementById('msg').value;
			socket.send(msg);
			document.getElementById('msg').value ="";
		}
	</script>
	<script th:src="@{/assets/js/vendor.min.js}"></script>

	<!-- Import Js Files -->
	<script
		th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
	<script th:src="@{/assets/js/theme/app.init.js}"></script>
	<script th:src="@{/assets/js/theme/theme.js}"></script>
	<script th:src="@{/assets/js/theme/app.min.js}"></script>
	<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>

	<!-- solar icons -->
	<script
		src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
	<script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
	<script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
	<script th:src="@{/assets/js/dashboards/dashboard.js}"></script>

	<!-- Bootstrap Common JS Files End -->
	<script
		src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
	<script src="../js/ysw/chat.js"></script>
</th:block>
</html>