<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/include/layout}">

<th:block layout:fragment="content">
			<!--상단 홈 아이콘 / ...  -->
	<div class="col-lg-8 col-md-6 col-12 align-self-center">
          <nav aria-label="breadcrumb">
              <ol class="breadcrumb align-items-center">
                 <li class="breadcrumb-item">
                   <a class="text-muted text-decoration-none" th:href="@{/home}">
                     <i class="ti ti-home fs-5"></i>
                    </a>
                 </li>
              <li class="breadcrumb-item" aria-current="page">자유게시판</li>
               </ol>
           </nav><br>
    <h2 class="mb-0 fw-bolder fs-8">자유 게시판 작성</h2>
    </div><br>

  <!-- Summernote CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css">


    <form th:action="@{/board/create}" method="post" enctype="multipart/form-data" id="board_form">

      <!-- 제목 + 투표 버튼 -->
      <div class="mb-3">
        <div class="d-flex justify-content-between align-items-end">
          <label class="form-label mb-0"><strong>제목</strong></label>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="addVote()">투표 추가</button>
        </div>
        <input type="text" class="form-control mt-1" id="board_title" name="board_title" maxlength="100" placeholder="제목을 입력하세요">
        <!--트랜잭션 처리 하기위해서 추가함 -->
        <input type="hidden" name="board_writer" value="11">
		<input type="file" name="files" multiple><br>
      </div>

	<!-- 파일 첨부 제목 -->
	<div class="mb-3">
  		<label class="form-label mb-1"><strong>파일 첨부</strong></label>

  	<!-- 드래그 앤 드롭 박스 -->
<div class="dropzone mt-2" id="dropzone" style="border: 1px dashed #ccc; padding: 20px; text-align: center; border-radius: 10px;">
  <p class="mb-0" id="dropzone_hint">
    여기에 파일을 끌어다 놓거나 
    <span id="file_trigger" style="color: #0d6efd; text-decoration: underline; cursor: pointer;">파일 추가</span>를 누르세요.
  </p>
  <input type="file" id="file_input" multiple style="display: none;" />
  <ul id="file_list" style="list-style: none; padding-left: 0; margin-top: 10px;"></ul>
</div>
</div>

      <!-- 내용 + Summernote -->
      <div class="mb-3">
        <label class="form-label" for="board_content"><strong>내용</strong></label>
        <textarea id="board_content" name="board_content"></textarea>
      </div>

      <!-- 작성 / 임시저장 버튼 -->
   <div class="d-flex justify-content-end gap-2 mt-4">
    <button type="submit" class="btn btn-primary">작성 완료</button>
    <button type="button" class="btn btn-secondary" onclick="saveTemp()">임시저장</button>
  </div>

    </form>

  <!-- jQuery + Summernote JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>



  <!-- Summernote & 드래그 앤 드롭 초기화 -->
  <script>
    $('#board_content').summernote({
      height: 300,
      lang: 'ko-KR',
      placeholder: '300자 이내로 입력하세요',
      width: '100%',
      callbacks: {
        onImageUpload: function(files) {
          let data = new FormData();
          data.append("file", files[0]);
          $.ajax({
            url: "/board/uploadImage",
            method: "POST",
            data: data,
            processData: false,
            contentType: false,
            success: function(result) {
              $('#board_content').summernote('insertImage', result.url);
            }
          });
        }
      }
    });

    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("file_input");
    const fileTrigger = document.getElementById("file_trigger");
    const fileList = document.getElementById("file_list");
    const dropzoneHint = document.getElementById("dropzone_hint");

    // 🔹 파일 목록 출력 + 힌트 숨기기
    function displayFiles(files) {
      if (files.length > 0) {
        dropzoneHint.style.display = "none"; // 안내 문구 숨김
      }

      for (let file of files) {
        const li = document.createElement("li");
        li.textContent = file.name;
        fileList.appendChild(li);
      }
    }

    // 드래그 관련 이벤트
    dropzone.addEventListener("dragover", function(e) {
      e.preventDefault();
      dropzone.style.backgroundColor = "#f1f1f1";
    });

    dropzone.addEventListener("dragleave", function(e) {
      e.preventDefault();
      dropzone.style.backgroundColor = "white";
    });

    dropzone.addEventListener("drop", function(e) {
      e.preventDefault();
      dropzone.style.backgroundColor = "white";
      const files = e.dataTransfer.files;
      displayFiles(files);
    });

    // 파일 선택 버튼 클릭
    fileTrigger.addEventListener("click", function() {
      fileInput.click();
    });

    // 파일 선택 시 처리
    fileInput.addEventListener("change", function() {
      displayFiles(fileInput.files);
    });

    function addVote() {
      alert("투표 추가 준비중!");
    }

    function saveTemp() {
      alert("임시저장 준비중!");
    }
  </script>

<!-- Bootstrap Common JS Files Start -->

	<!-- Import vendorJs Files -->
	<script th:src="@{/assets/js/vendor.min.js}"></script>
	
  	<!-- Import Js Files -->
  	<script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  	<script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
  	<script th:src="@{/assets/js/theme/app.init.js}"></script>
  	<script th:src="@{/assets/js/theme/theme.js}"></script>
  	<script th:src="@{/assets/js/theme/app.min.js}"></script>
  	<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>

  	<!-- solar icons -->
  	<script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  	<script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
  	<script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  	<script th:src="@{/assets/js/dashboards/dashboard.js}"></script>
  	
  	<!-- Bootstrap Common JS Files End -->
</th:block>
</html>