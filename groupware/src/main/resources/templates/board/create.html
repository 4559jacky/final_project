<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{/include/layout}">

<th:block layout:fragment="content">

  <!-- 상단 네비게이션 -->
  <div class="col-lg-8 col-md-6 col-12 align-self-center">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb align-items-center">
        <li class="breadcrumb-item">
          <a class="text-muted text-decoration-none" th:href="@{/home}">
            <i class="ti ti-home fs-5"></i>
          </a>
        </li>
        <li class="breadcrumb-item" aria-current="page">자유게시판</li>
      </ol>
    </nav>
    <h2 class="mb-0 fw-bolder fs-8 mt-3">자유 게시판 작성</h2>
  </div>

  <!-- Summernote CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css">

  <!-- 작성 폼 -->
  <form th:action="@{/board/create}" method="post" enctype="multipart/form-data" id="board_form" class="mt-4">

    <!-- 제목 + 투표 버튼 -->
    <div class="mb-3">
      <div class="d-flex justify-content-between align-items-end">
        <label for="board_title" class="form-label mb-0"><strong>제목</strong></label>
        <button type="button" class="btn btn-outline-primary btn-sm" onclick="addVote()">투표 추가</button>
      </div>
      <input type="text" class="form-control mt-1" id="board_title" name="board_title" maxlength="100" placeholder="제목을 입력하세요">
    </div>

    <!-- 파일 첨부 -->
    <div class="mb-3">
      <label class="form-label mb-1"><strong>파일 첨부</strong></label>
      <div class="dropzone mt-2" id="dropzone" style="border: 1px dashed #ccc; padding: 20px; text-align: center; border-radius: 10px;">
        <p class="mb-0" id="dropzone_hint">
          여기에 파일을 끌어다 놓거나 
          <span id="file_trigger" style="color: #0d6efd; text-decoration: underline; cursor: pointer;">파일 추가</span>를 누르세요.
        </p>
        <input type="file" id="file_input" name="files" multiple style="display: none;">
        <ul id="file_list" class="mt-2 list-unstyled"></ul>
      </div>
    </div>

    <!-- 내용 -->
    <div class="mb-3">
      <label for="board_content" class="form-label"><strong>내용</strong></label>
      <textarea id="board_content" name="board_content"></textarea>
    </div>

    <!-- 버튼 영역 -->
    <div class="d-flex justify-content-end gap-2 mt-4">
      <button type="submit" class="btn btn-primary">작성 완료</button>
      <button type="button" class="btn btn-secondary" onclick="saveTemp()">임시저장</button>
    </div>
  </form>

  <!-- JS 라이브러리 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>

  <!-- Summernote 옵션 -->
  <script>
  $('#board_content').summernote({
	  height: 300,
	  lang: 'ko-KR',
	  placeholder: '300자 이내로 입력하세요',
	  width: '100%',
	  fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '28', '36'],
	  toolbar: [
	    ['style', ['bold', 'italic', 'underline', 'clear']],
	    ['fontsize', ['fontsize']], // 폰트 사이즈 설정 활성화
	    ['para', ['ul', 'ol', 'paragraph']],
	    ['insert', ['picture', 'link', 'video']],
	    ['view', ['fullscreen', 'codeview']]
	  ],
	  callbacks: {
	    onImageUpload: function(files) {
	      let data = new FormData();
	      data.append("file", files[0]);
	      $.ajax({
	        url: "/board/uploadImage",
	        method: "POST",
	        data: data,
	        processData: false,
	        contentType: false,
	        success: function(result) {
	          $('#board_content').summernote('insertImage', result.url);
	        }
	      });
	    }
	  }
	});
  </script>

  <!-- 파일 드롭존 스크립트 -->
  <script>
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("file_input");
    const fileTrigger = document.getElementById("file_trigger");
    const fileList = document.getElementById("file_list");
    const dropzoneHint = document.getElementById("dropzone_hint");

    function displayFiles(files) {
      if (files.length > 0) dropzoneHint.style.display = "none";
      for (let file of files) {
        const li = document.createElement("li");
        li.textContent = file.name;
        fileList.appendChild(li);
      }
    }

    dropzone.addEventListener("dragover", function(e) {
      e.preventDefault();
      dropzone.style.backgroundColor = "#f8f9fa";
    });

    dropzone.addEventListener("dragleave", function(e) {
      e.preventDefault();
      dropzone.style.backgroundColor = "white";
    });

    dropzone.addEventListener("drop", function(e) {
      e.preventDefault();
      dropzone.style.backgroundColor = "white";
      displayFiles(e.dataTransfer.files);
    });

    fileTrigger.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", () => displayFiles(fileInput.files));
  </script>

  <!-- 버튼 관련 함수 -->
  <script>
    function addVote() {
      alert("투표 추가 기능은 예정이용!!!");
    }

    function saveTemp() {
      alert("임시 저장 기능은 예정이용!!!");
    }
  </script>

  <!-- Bootstrap 및 기타 JS -->
  <script th:src="@{/assets/js/vendor.min.js}"></script>
  <script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  <script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
  <script th:src="@{/assets/js/theme/app.init.js}"></script>
  <script th:src="@{/assets/js/theme/theme.js}"></script>
  <script th:src="@{/assets/js/theme/app.min.js}"></script>
  <script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>
  <script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
  <script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  <script th:src="@{/assets/js/dashboards/dashboard.js}"></script>

</th:block>
</html>