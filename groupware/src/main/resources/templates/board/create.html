<!DOCTYPE html>
<html lang="en" dir="ltr" data-bs-theme="light" data-color-theme="Blue_Theme" data-layout="horizontal"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/include/layout}">

<th:block layout:fragment="content">

  <!-- Summernote CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css">
  
  <div class="col-lg-8 col-md-6 col-12 align-self-center">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb align-items-center">
        <li class="breadcrumb-item">
          <a class="text-muted text-decoration-none" th:href="@{/home}">
            <i class="ti ti-home fs-5"></i>
          </a>
        </li>
        <li class="breadcrumb-item" aria-current="page">게시판 작성</li>
      </ol>
    </nav><br>
  </div><br>

  <div class="container mt-5" style="max-width: 800px;">
    <h3 class="text-center mb-4">자유게시판 작성</h3>

    <form th:action="@{/board/create}" method="post" enctype="multipart/form-data" id="board_form">
      
      <!-- 제목 및 투표 추가 버튼 -->
      <div class="mb-3 d-flex justify-content-between align-items-center">
        <div style="flex-grow: 1;">
          <label class="form-label" for="board_title"><strong>제목</strong></label>
          <input type="text" class="form-control" id="board_title" name="board_title" placeholder="제목을 입력하세요">
        </div>
        <button type="button" class="btn btn-outline-primary ms-3" onclick="addVote()">투표 추가</button>
      </div>

      <!-- 파일 첨부 -->
      <div class="mb-3">
        <label class="form-label"><strong>파일 첨부</strong></label>
        <div class="dropzone" id="dropzone">
          <p>여기에 파일을 끌고 오세요. 파일을 선택하세요.</p>
        </div>
        <input type="file" id="file_input" name="files" multiple style="display: none;">
        <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('file_input').click()">파일 선택</button>
      </div>

      <!-- 내용 입력 -->
      <div class="mb-3">
        <label class="form-label" for="board_content"><strong>내용</strong></label>
        <textarea id="board_content" name="board_content"></textarea>
      </div>
      
      <!-- 하단 버튼 -->
      <div class="d-flex justify-content-end gap-2 mt-4">
        <button type="submit" class="btn btn-primary">등록</button>
        <button type="button" class="btn btn-secondary" onclick="saveTemp()">임시저장</button>
      </div>
    </form>
  </div>

  <!-- jQuery + Summernote JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

  <!-- Summernote & 드래그 앤 드롭 초기화 -->
  <script>
    $('#board_content').summernote({
      height: 300,
      lang: 'ko-KR',
      placeholder: '300자 이내로 입력하세요',
      callbacks: {
        onImageUpload: function(files) {
          let data = new FormData();
          data.append("file", files[0]);
          $.ajax({
            url: "/board/uploadImage",
            method: "POST",
            data: data,
            processData: false,
            contentType: false,
            success: function(result) {
              $('#board_content').summernote('insertImage', result.url);
            }
          });
        }
      }
    });

    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("file_input");

    dropzone.addEventListener("dragover", function(e) {
      e.preventDefault();
      dropzone.classList.add("dragover");
    });

    dropzone.addEventListener("dragleave", function(e) {
      dropzone.classList.remove("dragover");
    });

    dropzone.addEventListener("drop", function(e) {
      e.preventDefault();
      dropzone.classList.remove("dragover");

      const files = e.dataTransfer.files;
      fileInput.files = files;
    });
  </script>

</th:block>
</html>