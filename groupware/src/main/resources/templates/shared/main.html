<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/include/layout}">

<th:block layout:fragment="content">
<head>
  <link rel="stylesheet" th:href="@{/css/hjh/sharedMain.css}">

  <script th:src="@{/js/jquery-3.7.1.js}"></script>

  <link href="https://cdn.jsdelivr.net/npm/jstree@3.3.12/dist/themes/default/style.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jstree@3.3.12/dist/jstree.min.js"></script>
  <script src="/js/hjh/jstree.js"></script>
</head>

<div class="container-fluid">
  <div class="col-lg-8 col-md-6 col-12 align-self-center">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb align-items-center">
        <li class="breadcrumb-item">
          <a class="text-muted text-decoration-none" th:href="@{/home}">
            <i class="ti ti-home fs-5"></i>
          </a>
        </li>
        <li class="breadcrumb-item" aria-current="page">공유문서함</li>
      </ol>
    </nav>
    <br>
    <h2 class="mb-0 fw-bolder fs-8">공유문서함</h2>
  </div>
  <br>
	
	
	
<div class="card p-4">
	
	<!-- 탭 영역: 개인, 부서, 공용 -->
<ul class="nav nav-tabs mb-3" id="shared-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="personal-tab" data-bs-toggle="tab" data-bs-target="#personal-pane" type="button" role="tab">👤 개인</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="department-tab" data-bs-toggle="tab" data-bs-target="#department-pane" type="button" role="tab">🏢 부서</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="public-tab" data-bs-toggle="tab" data-bs-target="#public-pane" type="button" role="tab">🌐 공용</button>
  </li>
</ul>
	
	
  <div class="row">
    <!-- 왼쪽 트리 -->
    <div class="col-md-3 mb-4">
      <div class="bg-white p-3 rounded-3 shadow-sm mb-3">
        <h5 class="fw-bold mb-2">📁 폴더</h5>
        <!-- 트리 영역 -->
			<div id="personal-tree" class="shared-tree" style="min-height: 200px; display: none;"></div>
			<div id="department-tree" class="shared-tree" style="min-height: 200px; display: none;"></div>
			<div id="public-tree" class="shared-tree" style="min-height: 200px; display: none;"></div>
      </div>
      
      <div class="card bg-body text-body shadow-sm rounded-3" id="chart-card">
      	 <h5 class="fw-bold mb-2">📁 공유문서함 사용량</h5>
  		<div class="card-body p-3">
    		<!-- 차트 영역 -->
			<div id="personal-chart" class="chart-container" style="height: 220px; display: none;"></div>
			<div id="department-chart" class="chart-container" style="height: 220px; display: none;"></div>
			<div id="public-chart" class="chart-container" style="height: 220px; display: none;"></div>
  			<div id="chart-usage-summary" class="text-center mt-3 small text-muted">
 			 <!-- 여기에 JS로 용량 표시 -->
 			  <h5 class="fw-bold mb-2">전체 용량: <span id="total-size"></span></h5>
  			  <div class="fw-bold mb-2">문서함: <span id="active-size"></span></div>
              <div class="fw-bold mb-2">휴지통: <span id="trash-size"></span></div>
              <div class="fw-bold mb-2">남은 용량: <span id="remain-size"></span></div>
			</div>
  		</div>
	</div>
      
    </div>
		

    <!-- 오른쪽 콘텐츠 영역 -->
    <div class="col-md-9 mb-4">
      <div class="table-wrapper p-4 bg-white rounded-4 shadow-sm">


        <!-- 탭 영역 -->
        <ul class="nav nav-pills mb-3" id="shared-tab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="doc-tab" data-bs-toggle="pill" data-bs-target="#doc-tab-pane" type="button" role="tab">📁 문서함</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="trash-tab" data-bs-toggle="pill" data-bs-target="#trash-tab-pane" type="button" role="tab">🗑️ 휴지통</button>
          </li>
        </ul>

        <!-- 탭 컨텐츠 -->
        <div class="tab-content" id="shared-tab-content">
           <!-- 개인 탭 -->
  <div class="tab-pane fade show active" id="personal-pane" role="tabpanel" aria-labelledby="personal-tab">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#folderModal">📁 새폴더</button>
        <input type="file" id="personal-fileUpload" multiple>
        <button class="btn btn-sm btn-primary me-2" onclick="uploadFiles('personal')">업로드</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table align-middle text-center" id="personal-folder-table">
        <thead class="bg-light">
          <tr>
            <th>이름</th>
            <th>종류</th>
            <th>크기</th>
            <th>등록일</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- 부서 탭 -->
  <div class="tab-pane fade" id="department-pane" role="tabpanel" aria-labelledby="department-tab">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#folderModal">📁 새폴더</button>
        <input type="file" id="department-fileUpload" multiple>
        <button class="btn btn-sm btn-primary me-2" onclick="uploadFiles('department')">업로드</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table align-middle text-center" id="department-folder-table">
        <thead class="bg-light">
          <tr>
            <th>이름</th>
            <th>종류</th>
            <th>크기</th>
            <th>등록일</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- 공용 탭 -->
  <div class="tab-pane fade" id="public-pane" role="tabpanel" aria-labelledby="public-tab">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#folderModal">📁 새폴더</button>
        <input type="file" id="public-fileUpload" multiple>
        <button class="btn btn-sm btn-primary me-2" onclick="uploadFiles('public')">업로드</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table align-middle text-center" id="public-folder-table">
        <thead class="bg-light">
          <tr>
            <th>이름</th>
            <th>종류</th>
            <th>크기</th>
            <th>등록일</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

		<!-- 개인 휴지통 -->
<div class="tab-pane fade" id="trash-tab-personal" role="tabpanel" aria-labelledby="personal-tab">
  <div class="d-flex justify-content-end mb-2">
    <button class="btn btn-sm btn-secondary me-2" onclick="restoreSelected('personal')">복구</button>
    <button class="btn btn-sm btn-danger" onclick="deleteSelected('personal')">삭제</button>
  </div>
  <div class="table-responsive">
    <table class="table align-middle text-center" id="trash-table-personal">
      <thead class="bg-light">
        <tr>
          <th>선택</th>
          <th>이름</th>
          <th>종류</th>
          <th>크기</th>
          <th>삭제일</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- 부서 휴지통 -->
<div class="tab-pane fade" id="trash-tab-department" role="tabpanel" aria-labelledby="department-tab">
  <div class="d-flex justify-content-end mb-2">
    <button class="btn btn-sm btn-secondary me-2" onclick="restoreSelected('department')">복구</button>
    <button class="btn btn-sm btn-danger" onclick="deleteSelected('department')">삭제</button>
  </div>
  <div class="table-responsive">
    <table class="table align-middle text-center" id="trash-table-department">
      <thead class="bg-light">
        <tr>
          <th>선택</th>
          <th>이름</th>
          <th>종류</th>
          <th>크기</th>
          <th>삭제일</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- 공용 휴지통 -->
<div class="tab-pane fade" id="trash-tab-public" role="tabpanel" aria-labelledby="public-tab">
  <div class="d-flex justify-content-end mb-2">
    <button class="btn btn-sm btn-secondary me-2" onclick="restoreSelected('public')">복구</button>
    <button class="btn btn-sm btn-danger" onclick="deleteSelected('public')">삭제</button>
  </div>
  <div class="table-responsive">
    <table class="table align-middle text-center" id="trash-table-public">
      <thead class="bg-light">
        <tr>
          <th>선택</th>
          <th>이름</th>
          <th>종류</th>
          <th>크기</th>
          <th>삭제일</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- 폴더 생성 모달 그대로 유지 -->
<div class="modal fade" id="folderModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content p-4">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold">📁 새 폴더 생성</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body row">
        <div class="col-md-6 border-end">
          <div id="modal-folder-tree" style="min-height: 200px;"></div>
        </div>
        <div class="col-6">
          <input type="hidden" id="member-no-hidden" th:value="${#authentication.principal.member.memberNo}">
          <input type="text" id="new-folder-name" class="form-control mb-3" placeholder="폴더 이름">         
          <br><button class="btn btn-primary" onclick="createNewFolder()">📁 폴더 생성</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script th:src="@{/assets/js/vendor.min.js}"></script>
<script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/theme/app.init.js}"></script>
<script th:src="@{/assets/js/theme/theme.js}"></script>
<script th:src="@{/assets/js/theme/app.min.js}"></script>
<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
 <script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  <script th:src="@{/js/hjh/chart.js}"></script>
</th:block>
</html>
