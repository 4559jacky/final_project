<!DOCTYPE html>
<html
xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{/include/layout}">
<th:block layout:fragment="content">
	
	<script th:src="@{/js/jquery-3.7.1.js}"></script>
	
	<link th:href="@{/css/cjs/dept_create.css}" rel="stylesheet">
	
	<!-- jsTree -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
	
	<div class="page-titles mb-7 mb-md-5">
		<div class="row">
			<div class="col-lg-8 col-md-6 col-12 align-self-center">
				<nav aria-label="breadcrumb">
                	<ol class="breadcrumb align-items-center">
                		<li class="breadcrumb-item">
                    		<a class="text-muted text-decoration-none" th:href="@{/home}">
                     			<i class="ti ti-home fs-5"></i>
                    		</a>
                   	 	</li>
						<li class="breadcrumb-item" aria-current="page">인사 담당자 / 인사 관리</li>
                  	</ol>
				</nav><br>
				<h2 class="mb-0 fw-bolder fs-8">인사 관리</h2>
			</div><br>
		</div>
	</div>
	
	<div class="card">
        <div class="card-body">
        	<div class="tab-content" id="pills-tabContent">
            	<div class="tab-pane fade show active" id="pills-account" role="tabpanel" aria-labelledby="pills-account-tab" tabindex="0">
					<div class="row">
                    	<div class="col-lg-3 d-flex align-items-stretch">
                    		<div class="card w-100 border position-relative overflow-hidden">
                        		<div class="card-body p-4">
                          			<h4 class="card-title" style="font-weight: bold;">부서</h4>
                          			<br>
  									
  									<th:block th:if="${!#lists.isEmpty(deptList)}">
  									<div class="d-flex justify-content-start mb-3">
   										<button id="expand_all" class="btn btn-sm px-1 py-0 border text-secondary bg-light-subtle me-1">+</button>
   										<button id="collapse_all" class="btn btn-sm px-1 py-0 border text-secondary bg-light-subtle">-</button>
									</div>
									</th:block>
									<th:block th:if="${#lists.isEmpty(deptList)}">
  									<div class="d-flex justify-content-start mb-3">
   										등록된 부서가 없습니다.
									</div>
									</th:block>
									
									<div id="dept-tree">
   										<ul>
									      <li th:each="dept : ${departments}" th:id="'dept_' + ${dept.id}" th:data-parent="'#'">
									         <span th:text="${dept.name}"></span>
									      </li>
									   </ul>
									</div>
									
									<!-- jsTree 데이터 확인용 버튼 -->
  									<!-- <button id="jstree-btn">선택된 노드 보기</button> -->
  									
                        		</div>
                      		</div>
                   		</div>
                   		
                   		<div class="col-lg-9 d-flex align-items-stretch d-none" id="update_member_div">
                    		<div class="card w-100 border position-relative overflow-hidden">
                        		<div class="card-body p-4">
                        			<form name="update_member_form">
                          				<h4 class="card-title" style="font-weight: bold;">사원 목록</h4>
                          				<br>
                          				
                          				<div class="mb-3" style="display:none;">
                              				<label for="dept_list" class="form-label">부서목록</label>
                              				<input type="text" class="form-control" id="dept_list" name="dept_list" th:value="${deptList}">
                            			</div>
                          				
                          				<div class="mb-3" style="display:none;">
                              				<label for="dept_no" class="form-label">부서번호</label>
                              				<input type="text" class="form-control" id="dept_no" name="dept_no">
                            			</div>
                            			
                            			<div class="table-responsive mb-4 border rounded-1">
							                <table class="table text-nowrap mb-0 align-middle">
							                  <thead class="text-dark fs-4">
							                    <tr>
							                      <th>
							                        <h6 class="fs-4 fw-semibold mb-0">사원명(사번)</h6>
							                      </th>
							                      <th>
							                        <h6 class="fs-4 fw-semibold mb-0">부서</h6>
							                      </th>
							                      <th>
							                        <h6 class="fs-4 fw-semibold mb-0">직급</h6>
							                      </th>
							                      <th>
							                        <h6 class="fs-4 fw-semibold mb-0">상태</h6>
							                      </th>
							                      <th>
							                        <h6 class="fs-4 fw-semibold mb-0">권한</h6>
							                      </th>
							                    </tr>
							                  </thead>
							                  <tbody>
							                    <tr th:each="member : ${memberListByDept}">
							                    	<td>
												      <div class="d-flex align-items-center">
												        <img th:src="@{${member.profileImgUrl}}" class="rounded-circle" width="40" height="40" />
												        <div class="ms-3">
												          <h6 class="fs-4 fw-semibold mb-0" th:text="${member.memberName}">사원 이름</h6>
												          <span class="fw-normal" th:text="${member.memberNo}">사번</span>
												        </div>
												      </div>
												    </td>
							                      <td>
							                        <p class="mb-0 fw-normal fs-4">Elite Admin</p>
							                      </td>
							                      <td>
							                        <h6 class="fs-4 fw-semibold mb-0">$3.9k</h6>
							                      </td>
							                      <td>
							                        <span class="badge bg-success-subtle text-success">Active</span>
							                      </td>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <a href="javascript:void(0)" class="text-bg-secondary text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            S
							                          </a>
							                          <a href="javascript:void(0)" class="text-bg-danger text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            D
							                          </a>
							                        </div>
							                      </td>
							                    </tr>
							                    <tr>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <img src="../assets/images/profile/user-2.jpg" class="rounded-circle" width="40" height="40" />
							                          <div class="ms-3">
							                            <h6 class="fs-4 fw-semibold mb-0">Arlene McCoy</h6>
							                            <span class="fw-normal">Project Manager</span>
							                          </div>
							                        </div>
							                      </td>
							                      <td>
							                        <p class="mb-0 fw-normal fs-4">Real Homes WP Theme</p>
							                      </td>
							                      <td>
							                        <h6 class="fs-4 fw-semibold mb-0">$24.5k</h6>
							                      </td>
							                      <td>
							                        <span class="badge bg-warning-subtle text-warning">Pending</span>
							                      </td>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <a href="javascript:void(0)" class="text-bg-primary text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            A
							                          </a>
							                          <a href="javascript:void(0)" class="text-bg-warning text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            X
							                          </a>
							                          <a href="javascript:void(0)" class="text-bg-secondary text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            N
							                          </a>
							                        </div>
							                      </td>
							                    </tr>
							                    <tr>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <img src="../assets/images/profile/user-6.jpg" class="rounded-circle" width="40" height="40" />
							                          <div class="ms-3">
							                            <h6 class="fs-4 fw-semibold mb-0">Christopher Jamil</h6>
							                            <span class="fw-normal">Project Manager</span>
							                          </div>
							                        </div>
							                      </td>
							                      <td>
							                        <p class="mb-0 fw-normal fs-4">MedicalPro WP Theme</p>
							                      </td>
							                      
							                       <td>
							                        <h6 class="fs-4 fw-semibold mb-0">$12.8k</h6>
							                      </td>
							                      <td>
							                        <span class="badge bg-primary-subtle text-primary">Completed</span>
							                      </td>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <a href="javascript:void(0)" class="text-bg-danger text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            X
							                          </a>
							                        </div>
							                      </td>
							                    </tr>
							                    <tr>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <img src="../assets/images/profile/user-4.jpg" class="rounded-circle" width="40" height="40" />
							                          <div class="ms-3">
							                            <h6 class="fs-4 fw-semibold mb-0">Evelyn Pope</h6>
							                            <span class="fw-normal">Frontend Engineer</span>
							                          </div>
							                        </div>
							                      </td>
							                      <td>
							                        <p class="mb-0 fw-normal fs-4">Hosting Press HTML</p>
							                      </td>
							                      <td>
							                        <h6 class="fs-4 fw-semibold mb-0">$2.4k</h6>
							                      </td>
							                      <td>
							                        <span class="badge bg-success-subtle text-success">Active</span>
							                      </td>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <a href="javascript:void(0)" class="text-bg-primary text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            Y
							                          </a>
							                          <a href="javascript:void(0)" class="text-bg-danger text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            X
							                          </a>
							                        </div>
							                      </td>
							                    </tr>
							                    <tr>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <img src="../assets/images/profile/user-5.jpg" class="rounded-circle" width="40" height="40" />
							                          <div class="ms-3">
							                            <h6 class="fs-4 fw-semibold mb-0">Micheal Doe</h6>
							                            <span class="fw-normal">Content Writer</span>
							                          </div>
							                        </div>
							                      </td>
							                      <td>
							                        <p class="mb-0 fw-normal fs-4">Hosting Press HTML</p>
							                      </td>
							                      <td>
							                        <h6 class="fs-4 fw-semibold mb-0">$9.3k</h6>
							                      </td>
							                      <td>
							                        <span class="badge bg-danger-subtle text-danger">Cancel</span>
							                      </td>
							                      <td>
							                        <div class="d-flex align-items-center">
							                          <a href="javascript:void(0)" class="text-bg-secondary text-white fs-6 round-40 rounded-circle me-n2 card-hover border border-2 border-white d-flex align-items-center justify-content-center">
							                            S
							                          </a>
							                        </div>
							                      </td>
							                      
							                    </tr>
							                  </tbody>
							                </table>
							              </div>
                            			
                            			
                            			
                      					
                      				</form>
                        		</div>
                      		</div>
                   		</div>
                   		
                   		<div class="col-lg-9 d-flex align-items-stretch" id="none_member_div">
                    		<div class="card w-100 border position-relative overflow-hidden">
                        		<div class="card-body p-4">
                        			<h4 class="card-title" style="font-weight: bold;">사원 목록</h4>
                          			<br>
                        			
                        			조회할 부서를 선택해주세요.
                        		</div>
                      		</div>
                   		</div>
                   		
                  	</div>            	
                </div>
			</div>
		</div>
	</div>
	
	<script>
		$('#dept-tree').on('click', '.jstree-anchor', function (e) {
			e.stopPropagation();
											
			const nodeEl = $(this).closest('li'); 	// 해당 anchor의 상위 li로 접근해서
			const fullId = nodeEl.attr('id'); 		// 해당 li의 id값을 추출
																						
			const deptId = fullId?.replace('dept_', ''); // 클릭한 부서의 id를 추출

			if (deptId && deptId.trim().length > 0) {
				$("#update_member_div").removeClass("d-none");
				$("#none_member_div").addClass("d-none");
				
				$.ajax({
					type: "post",
					url: "/admin/member/select",
					headers : {
						'header': document.querySelector('meta[name="_csrf_header"]').content,
						'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
					},
					data: {
						deptId : deptId
					},
					dataType: "json",
					success: function(data) {
						console.log(data.member_list_by_dept);

						/* $('form[name="update_dept_form"] input[name="dept_no"]').val(Number(data.dept_no));
						$('form[name="update_dept_form"] input[name="dept_status"][value="' + data.dept_status + '"]').prop('checked', true);
						$('form[name="update_dept_form"] input[name="dept_name"]').val(data.dept_name);
						$('form[name="update_dept_form"] select[name="member_no"]').val(Number(data.member_no));
							
						$('form[name="update_dept_form"] select[name="parent_dept_no"]').val(Number(data.parent_dept_no));
						
						const parentSelect = $('form[name="update_dept_form"] select[name="parent_dept_no"]');
						parentSelect.find('option').each(function() {
							if ($(this).val() === String(currentDeptNo)) {
								$(this).css('display', 'none');
							} else {
								$(this).css('display', 'block');
							}
						});

						$('form[name="update_dept_form"] input[name="dept_phone"]').val(data.dept_phone);
						$('form[name="update_dept_form"] input[name="dept_location"]').val(data.dept_location); */
						
					},
					error: function(xhr, status, error) {
					    console.log("xhr:", xhr);  // XMLHttpRequest 객체
					    console.log("status:", status);  // 상태 코드 (예: "timeout", "error", "abort", "parsererror")
					    console.log("error:", error);  // 실제 오류 메시지
					}
				});
			}
		});
										
		$(document).on("click", function (e) {
			// 트리 안쪽이 아닌 다른 곳을 클릭했을 경우
			if (!$(e.target).closest('#dept-tree').length) {
				if (
					!$(e.target).closest('#dept-tree').length && 
					!$(e.target).closest('#update_member_div').length &&
					!$(e.target).closest('#create_member_div').length
				) {
					$("#update_member_div").addClass("d-none");
					$("#none_member_div").removeClass("d-none");
				}
			}
		});
	</script>
	
	<!-- Bootstrap Common JS Files Start -->
	
	<!-- Import vendorJs Files -->
	<script th:src="@{/assets/js/vendor.min.js}"></script>
	
  	<!-- Import Js Files -->
  	<script th:src="@{/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
  	<script th:src="@{/assets/libs/simplebar/dist/simplebar.min.js}"></script>
  	<script th:src="@{/assets/js/theme/app.init.js}"></script>
  	<script th:src="@{/assets/js/theme/theme.js}"></script>
  	<script th:src="@{/assets/js/theme/app.min.js}"></script>
  	<script th:src="@{/assets/js/theme/sidebarmenu.js}"></script>
	
  	<!-- solar icons -->
  	<script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  	<script th:src="@{/assets/libs/owl.carousel/dist/owl.carousel.min.js}"></script>
  	<script th:src="@{/assets/libs/apexcharts/dist/apexcharts.min.js}"></script>
  	<script th:src="@{/assets/js/dashboards/dashboard.js}"></script>
  	
  	<!-- Bootstrap Common JS Files End -->
  	
  	<!-- jsTree -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
	<script th:src="@{/js/cjs/jstree.js}"></script>

</th:block>
</html>